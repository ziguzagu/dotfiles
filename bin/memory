#!/bin/zsh
#
# memory - free RAM percent
#
set -eu -o pipefail

## for mac os
if [[ -x "$(which vm_stat)" ]]; then
    vmstat=$(vm_stat) || return 1
    pages_free=$(echo "$vmstat" | awk '/Pages free/ {print $3}' | tr -d '.')
    pages_active=$(echo "$vmstat" | awk '/Pages active/ {print $3}' | tr -d '.')
    pages_inactive=$(echo "$vmstat" | awk '/Pages inactive/ {print $3}' | tr -d '.')
    pages_speculative=$(echo "$vmstat" | awk '/Pages speculative/ {print $3}' | tr -d '.')
    pages_wired=$(echo "$vmstat" | awk '/Pages wired down/ {print $4}' | tr -d '.')

    free=$((($pages_free + $pages_speculative) * 4096 / 1024))
    used=$((($pages_active + $pages_inactive + $pages_wired) * 4096 / 1024))
    total=$(($free + $used))

    echo "$(($free * 100 / $total))%"
else
    free -m | awk '/\-\/\+ / {print $4"MB"}'
fi
